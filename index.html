<!DOCTYPE html>
<html lang="en">
	<head>

		<style>
			.map {
				width: 100%;
				height:100%;
				display: block;
				position: absolute;
				box-sizing: border-box;
			}
		</style>

		<!-- <link rel="stylesheet" href="build/ol.css"> -->
		<link href="ol.css" rel="preload" as="style"/>
		<script src="ol.js"></script>

		<!-- <include src="build/ol.html"/> -->

	</head>

	<body>
		<ol-map id="map" class="map" max-zoom="16" min-zoom="2">
			<select style="position:absolute;right:15px;top:15px;z-index:999" class="x-dropdown" style="width:100%;">
				<option>Maptiler CLOUD</option>
			</select>

			<ol-tile-osm></ol-tile-osm>
			
			<ol-layer-vector id="vector"/>

			<ol-overlay id="overlay" hidden="true">
				<p>Some teks</p>
				<p>Some teks</p>
				<p>Some teks</p>
				<p>Some teks</p>
			</ol-overlay>
 
		</ol-map>
		<script>
			document.addEventListener("DOMContentLoaded", function(){

				const element = document.getElementById('vector')
				const layer = element.getLayer()

				const dataset = new ol.source.Vector({features: []});


				layer.setSource(new ol.source.Cluster({
					distance: 35,
					source: dataset
				}));

				layer.setVisible(true);

				const features = [];
				const vehicle1 = new ol.trackpoint.VehicleMarker({
					type:         'BLACK',
					displayArrow: true,
					direction:    0,
					label:        '1',
					ll:           ol.fromLonLat([24.17056934104883,56.97212680217972]),
					tail:         true
				});

				const vehicle2 = new ol.trackpoint.VehicleMarker({
					type:         'BLACK',
					displayArrow: true,
					direction:    0,
					label:        '2',
					ll:           ol.fromLonLat([24.171599960947447, 56.97455965351052]),
					tail:         true
				});

				features.push(vehicle1);
				features.push(vehicle2);


				dataset.addFeatures(features);

				//return;

				const map = element.getMap();
				const overlay = document.getElementById('overlay')

				overlay.setProperties({
					autoPan: false,
					stopEvent: false,
					positioning: 'center-center',
					offset: [109, -150]
				});

				map.on("click", function(event) {
					const is_feature = map.forEachFeatureAtPixel(event.pixel, (feature, layer) => {
						if (!layer) {
							return;
						}

						if(overlay.isVisible()){
							overlay.close();
						}else{
							overlay.setPosition(ol.fromLonLat([24.17056934104883,56.97212680217972]));
						}
						

						//
						//document.getElementById('overlay')
						const extent = feature.getGeometry().getExtent();

						map.getView().fit(extent, {
							padding: [200, 200, 200, 200]
						});

						return true;

					});

					//console.log(is_feature);
				});

			});
		</script>

	</body>
</html>
